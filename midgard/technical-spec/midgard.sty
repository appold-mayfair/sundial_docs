%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Latex macro improvements
% \usepackage{etoolbox}
\usepackage{ifthen}
%\usepackage{xifthen}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page layout
\usepackage[top=2.5cm,left=2.5cm,right=2.5cm,bottom=2.5cm]{geometry}

% Chill out on the ``Overfull \hbox'' warnings.
\hfuzz=0.8em

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Color
\usepackage[table,xcdraw,svgnames]{xcolor}

% Cover page
\definecolor{midgard-cover-page-green}{HTML}{043815}
\definecolor{midgard-cover-page-draft}{HTML}{828282}

% Inline code
\definecolor{inline-code-dark-red}{HTML}{9a2626}

% Hyperlinks
\definecolor{link-blue}{HTML}{074db5}

% Highlights in block quotes
\colorlet{highlight-blue}{DeepSkyBlue!30}
\colorlet{highlight-yellow}{yellow!50}
\colorlet{highlight-lime}{lime!30}
\colorlet{highlight-pink}{pink!30}
\colorlet{highlight-purple}{MediumOrchid!30}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Line and paragraph spacing
\usepackage{setspace}
\linespread{1.08}

\usepackage[skip=0.8em plus 0.8em minus 0.3em]{parskip}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Math
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{empheq}

% Math font
\usepackage{notomath}

\usepackage{microtype}

% \usepackage{latexsym}

% Programming language semantics
\usepackage{semantic}
\setpremisesspace{1.8em}

% Theorems
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{property}{Property}[section]
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{corollary}[definition]{Corollary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyphenation
\usepackage{hyphenat}

% Preserve the old \texttt behaviour
\DeclareRobustCommand\ttfamily
        {\not@math@alphabet\ttfamily\mathtt
         \fontfamily\ttdefault\selectfont\hyphenchar\font=-1\relax}

% Create a new version of \texttt that hyphenates.
\DeclareTextFontCommand{\mytexttt}{\ttfamily\hyphenchar\font=45\relax}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Arrays and tabular typesetting
\usepackage{array}
\usepackage{booktabs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bullets and numbered lists
\usepackage{enumerate}

\usepackage{enumitem}
\setlist[description]{leftmargin=2.7em, labelindent=1.35em}
\setlist[itemize]{leftmargin=2.7em, labelindent=2.7em}

% Inline lists within paragraphs
% \usepackage{paralist}

% multi-column lists
\usepackage{multicol}
\newenvironment{itemize-multi}[1][2]%
{\begin{multicols}{#1}\raggedcolumns\begin{itemize}}%
{\end{itemize}\end{multicols}}

\newenvironment{enumerate-multi}[1][2]%
{\begin{multicols}{#1}\raggedcolumns\begin{enumerate}}%
{\end{enumerate}\end{multicols}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inline code
% styled with monospaced font in dark red color
\newcommand{\code}[1]{\textcolor{inline-code-dark-red}{\mytexttt{#1}}}
\newcommand{\codeNC}[1]{\texttt{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code blocks
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily,
  mathescape,
  backgroundcolor=\color{gray!20},
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Quote blocks
\usepackage{adjustbox}
\newcommand{\@quoteSym}{\fontsize{4em}{4.8em}\selectfont\textcolor{gray}{``}}
\newenvironment{quotePretty}{%
  \begin{center}\begin{adjustbox}{bgcolor=WhiteSmoke,minipage=0.95\linewidth}%
  \begin{adjustbox}{center,minipage=0.85\linewidth}%
}{
  \end{adjustbox}%
  \adjustbox{rlap,valign=b,raise=0.5em,scale={-1}{-1}}{\@quoteSym}% 
  \hspace{-\linewidth}%
  \adjustbox{rlap,valign=B,raise=0.5em,left=\linewidth}{\@quoteSym}%
  \hspace{-\linewidth}%   
  \end{adjustbox}\end{center}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Highlighting
\usepackage{soul}
\DeclareRobustCommand{\hlBlue}[1]{{\sethlcolor{highlight-blue}\hl{#1}}}
\DeclareRobustCommand{\hlYellow}[1]{{\sethlcolor{highlight-yellow}\hl{#1}}}
\DeclareRobustCommand{\hlLime}[1]{{\sethlcolor{highlight-lime}\hl{#1}}}
\DeclareRobustCommand{\hlPink}[1]{{\sethlcolor{highlight-pink}\hl{#1}}}
\DeclareRobustCommand{\hlPurple}[1]{{\sethlcolor{highlight-purple}\hl{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% References, hyperlinks, and bibliography
\usepackage[colon]{natbib}

\usepackage[
  unicode = true,
  pdftex,
  pdfa,
  colorlinks = true
]{hyperref}
\usepackage{hyperxmp}
\hypersetup{
  breaklinks = true,
  linkcolor = {link-blue},
  citecolor = {link-blue},
  urlcolor = {link-blue},
  pdfcreator=pdfLatex,
  pdfapart = 1,
  pdfaconformance = B,
}

\usepackage[capitalise,noabbrev,nameinlink]{cleveref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Images
\usepackage{graphicx}
\DeclareGraphicsExtensions{.pdf,.png}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Figures and tables
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

\newenvironment{ruledfigure}[1]{\begin{figure}[#1]}{\end{figure}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Rotated text
\usepackage{rotating}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Boxes for notes, tips, warnings, cautions, exclamations
\usepackage{awesomebox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Place a TODO marker at the page margin
\newcommand{\todo}{
    \marginpar{
        \begin{tikzpicture}
            \node[signal, xscale = -1, fill = orange!35]
                {\reflectbox{\large\textbf{TODO}}};
        \end{tikzpicture}
    }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Abstract for Latex book class (doesn't exist by default)
% Arguments:
% 1. (Optional) Adjust space between heading and text
% 2. Adjust left and right page margins
\newcommand\summaryname{Abstract}
\newenvironment{abstract}[2][-0.5em]%
    {\small\begin{center}%
        \bfseries{\summaryname}%
    \end{center}\vspace{#1}%
    \list{}{\rightmargin#2\leftmargin#2}\item[]}
    {\endlist{}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Contributors array (can also be used for authors)

% Internal variables
\newcounter{@contributorC}
\newcounter{@contributorI}
\newcommand{\@contributorNewLine}{\\}
\newcommand{\@contributorAutoPos}{%
\addtocounter{@contributorI}{1}%
\ifthenelse{\value{@contributorI} = \value{@contributorC}}%
{\setcounter{@contributorI}{0}\@contributorNewLine}%
{&}%
}

% Make a contributors array. Arguments:
% 1. Font size
% 2. Line space within a contributor entry
% 3. Line space between contributor entries
% 4. Number of columns
\newenvironment{contributors}[4]{\fontsize{#1}{#2}\selectfont%
\renewcommand{\@contributorNewLine}{\\[#3]}%
\setcounter{@contributorC}{#4}%
\setcounter{@contributorI}{0}%
\begin{tabular}[t]{*{\value{@contributorC}}{c}}}
{\end{tabular}}

% Make a contributor entry in the array. Arguments:
% 1. (Optional) extra field (e.g., email)
% 2. Author name
% 3. Author organization
\newcommand{\contributor}[3][]{\begin{tabular}{c}#2 \\ \small #3 \\ \small #1 \end{tabular}\@contributorAutoPos}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright notice at bottom of first non-cover page
\usepackage[
  type={CC},
  modifier={by-sa},
  version={4.0},
]{doclicense}

\newcommand{\copyrightnotice}{%
\footnotesize%
\doclicenseLongText%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Git revision info

\usepackage[local]{gitinfo2}

% Lifted from gitinfo2
\renewcommand{\gitMarkPref}{}
\IfEq{\gitDirty}{}{}{%
  \renewcommand{\gitMarkPref}{[Dirty]~}
}%

\newcommand{\gitBranchHash}{Branch:~\gitBranch~@~\gitAbbrevHash{}~}

\newcommand{\gitReleaseDate}{%
  \IfEq{\gitRel}{}{%
    Commit date:~\gitAuthorDate%
  }{%
    Release:~\gitRel~(\gitAuthorDate)%
  }%
}

\newcommand{\gitWatermark}{%
\footnotesize\color{gray}
\gitMarkPref%
\gitBranchHash%
\textbullet{}~%
\gitReleaseDate
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fancy headers
\usepackage{fancyhdr}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}%
\fancyfoot[C]{\thepage}
\fancyfoot[R]{\\[0.2em]\gitWatermark}

\pagestyle{fancy}

% Force fancy headers in chapter pages
\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{fancy}}{}{}
